<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CoinRadar - Cryptocurrency Tracker</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      th:href="@{/webjars/bootstrap/5.3.0/css/bootstrap.min.css}"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="stylesheet" th:href="@{/css/nav.css}" />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8f9fa;
        margin: 0;
        padding: 0;
      }

      .navbar {
        background-color: #343a40;
        padding: 10px 15px;
      }
      .navbar-brand {
        font-size: 1.8rem;
        font-weight: bold;
        color: #fff;
        text-decoration: none;
        cursor: pointer;
      }

      .navbar-brand:hover {
        color: #fff;
        text-decoration: none;
      }
      .navbar-brand span {
        color: #e07b12;
      }
      .navbar-buttons {
        display: flex;
        gap: 10px;
      }
      .btn-3d {
        border-radius: 20px;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      .btn-3d:hover {
        transform: translateY(-3px);
        box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.2);
      }

      .slider-container {
        overflow: hidden;
        white-space: nowrap;
        position: relative;
        width: 100%;
        background-color: #343a40;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
      }

      .slider {
        display: flex;
        gap: 20px;
        animation: slide 15s linear infinite;
      }

      @keyframes slide {
        0% {
          transform: translateX(0);
        }
        100% {
          transform: translateX(-100%);
        }
      }

      .slider-item {
        display: inline-block;
        background-color: #444;
        color: white;
        padding: 10px;
        border-radius: 10px;
        text-align: center;
        min-width: 150px;
        flex-shrink: 0;
        font-size: 0.8rem;
      }

      .slider-item img {
        max-width: 30px;
        height: 30px;
        margin-bottom: 5px;
        border-radius: 50%;
        border: 1px solid #e07b12;
        padding: 5px;
        background-color: #fff;
      }

      .slider-item a {
        text-decoration: none;
        color: #e07b12;
      }

      .slider-item a:hover {
        color: #ffbe0b;
      }

      .slider-container p {
        font-size: 1.1rem;
        color: orange;
        margin-bottom: 10px;
      }

      .hero {
        background: #343a40;
        color: #fff;
        padding: 5px 5px;
        text-align: center;
        border-radius: 10px;
        margin-bottom: 10px;
      }
      .hero h1 {
        font-size: 2.2rem;
        font-weight: bold;
        margin-bottom: 2px;
      }
      .hero p {
        font-size: 1.3rem;
        margin-bottom: 0;
      }

      .table {
        margin-top: 20px;
        border-collapse: collapse;
      }
      .table th {
        background-color: #444;
        color: #e07b12;
      }

      table td {
        border: none; /* Removes the inner borders */
      }

      .table tbody tr:hover {
        background-color: rgba(224, 123, 18, 0.1);
      }
      .crypto-logo {
        width: 32px;
        height: 32px;
      }

      .pagination .page-item.active .page-link {
        background-color: #e07b12;
        border-color: #e07b12;
      }

      footer {
        background-color: #343a40;
        color: #fff;
        text-align: center;
        padding: 10px 0;
        margin-top: 40px;
        font-size: 0.9rem;
      }
      .crypto-logo {
        width: 32px;
        height: 32px;
      }
      .btn-added {
        background-color: green !important;
        color: white !important;
        pointer-events: none;
        border: 1px solid green;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="container-fluid">
        <a
          class="navbar-brand"
          th:href="@{/user(username=${username ?: 'defaultUsername'})}"
        >
          Coin<span>Radar</span>
        </a>
        <div class="navbar-buttons">
          <button
            id="newsButton"
            class="btn btn-3d btn-outline-light me-2"
            onclick="navigateToNews()"
          >
            News
          </button>
          <button
            id="watchlistButton"
            class="btn btn-3d btn-outline-warning me-2"
            onclick="navigateToWatchlist()"
          >
            My Watchlist
          </button>
          <a href="/" class="btn btn-3d btn-outline-danger">Log Out</a>
        </div>
      </div>
    </nav>

    <div class="container">
      <!-- Header Section -->
      <div class="header-section text-center mb-4">
        <h1>Welcome, <span th:text="${username}"></span>!</h1>
        <p>
          Keep an eye on your favorite coins and discover new market
          opportunities.
        </p>
      </div>

      <!-- Cryptocurrency Table -->
      <div class="table-responsive">
        <table class="table table-dark table-striped table-hover">
          <thead>
            <tr>
              <th>#</th>
              <th>Coin</th>
              <th>Symbol</th>
              <th>Current Price (USD)</th>
              <th>Market Cap (USD)</th>
              <th>24h Change (%)</th>
              <th>Watchlist</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="crypto, iterStat : ${cryptos}">
              <td
                th:text="${(currentPage - 1) * pageSize + iterStat.index + 1}"
              ></td>
              <td>
                <img
                  th:src="${crypto.logoUrl}"
                  alt="Logo"
                  class="me-2 crypto-logo"
                />
                <span th:text="${crypto.name}">Coin Name</span>
              </td>
              <td th:text="${crypto.symbol.toUpperCase()}"></td>
              <td
                th:text="'$' + ${#numbers.formatDecimal(crypto.currentPrice, 1, 'COMMA', 2, 'POINT')}"
              ></td>
              <td
                th:text="'$' + ${#numbers.formatDecimal(crypto.marketCap, 0, 'COMMA', 0, 'POINT')}"
              ></td>
              <td
                th:classappend="${crypto.priceChangePercentage24h > 0 ? 'text-success' : 'text-danger'}"
                th:text="${#numbers.formatDecimal(crypto.priceChangePercentage24h, 1, 2)} + '%'"
              ></td>
              <td>
                <button
                  class="btn btn-outline-secondary"
                  th:data-id="${crypto.id}"
                  th:data-name="${crypto.name}"
                  th:data-symbol="${crypto.symbol}"
                  th:data-price="${crypto.currentPrice}"
                  th:data-marketcap="${crypto.marketCap}"
                  th:data-change="${crypto.priceChangePercentage24h}"
                  th:data-logo="${crypto.logoUrl}"
                  onclick="addToWatchlist(event)"
                >
                  ⭐
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div>© 2024 CoinRadar. All rights reserved.</div>
    </footer>

    <!-- Scripts -->
    <script>
      // Navigate to the news page
      function navigateToNews() {
        window.location.href = "/user/news";
      }

      // Navigate to the watchlist page
      function navigateToWatchlist() {
        window.location.href = "/user/watchlist";
      }

      // Add to watchlist
      function addToWatchlist(event) {
        const username = "[[${username}]]";
        const cryptoId = event.target.getAttribute("data-id");
        const name = event.target.getAttribute("data-name");
        const symbol = event.target.getAttribute("data-symbol");
        const currentPrice = event.target.getAttribute("data-price");
        const marketCap = event.target.getAttribute("data-marketcap");
        const priceChangePercentage24h =
          event.target.getAttribute("data-change");
        const logoUrl = event.target.getAttribute("data-logo");

        // Make the POST request
        fetch("https://coinradar.up.railway.app/user/watchlist/add", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: new URLSearchParams({
            username: username,
            id: cryptoId,
            name: name,
            symbol: symbol,
            currentPrice: currentPrice,
            marketCap: marketCap,
            priceChangePercentage24h: priceChangePercentage24h,
            logoUrl: logoUrl,
          }),
          credentials: "include", // Ensure session cookies are sent with the request
        })
          .then((response) => {
            if (response.ok) {
              event.target.style.backgroundColor = "green";
              event.target.style.color = "white";
              event.target.disabled = true;
              event.target.textContent = "Added ✔";
              alert("Added to watchlist!");
            } else {
              response
                .text()
                .then((text) => alert("Failed to add to watchlist: " + text));
            }
          })
          .catch((error) => console.error("Error:", error));
      }
    </script>
  </body>
</html>
